# 2026-02-11 - Vercel Deployment & Affiliate Link Fix

## Session Summary

### Part 1: Vercel Deployment Fixes (20:14-20:56 GMT+1)
**Problem:** Vercel build failing with `react-scripts: command not found`

**Root Causes & Fixes:**
1. fiber-shop-landing was a git submodule → Vercel couldn't access files
   - ✅ Removed submodule (git rm --cached, removed .git/modules)
   - ✅ Re-integrated as regular directory (commit a940ea6)

2. package-lock.json missing from git (in .gitignore)
   - ✅ Force-added package-lock.json (commit 6512857)

3. package-lock.json had macOS-specific deps (fsevents) → Linux build failed
   - ✅ Regenerated lock file without platform-specific deps

4. Root package.json conflicting with fiber-shop-landing/package.json
   - ✅ Removed root package.json and node_modules
   - ✅ Left only fiber-shop-landing as deployment root

5. Vercel trying `npm ci` but package-lock had issues
   - ✅ Changed to `npm install --legacy-peer-deps` (more flexible)
   - ✅ Set via Vercel API (v8/projects endpoint)

**Key Commits:**
- a940ea6: re-integrate fiber-shop-landing as normal directory
- 6512857: regenerate package-lock.json (force add)
- fc15bb9: remove root package.json and node_modules
- fd07141: trigger deploy with npm install (not npm ci)

**Status:** ✅ Build now succeeds, Vercel deployment working

---

### Part 2: Affiliate Link Issue (20:44+ GMT+1)
**Problem:** Affiliate links from Fiber API don't work
- URL format: `https://wild.link/e?d=rackroomshoes.com&u=https%3A%2F%2Fwww.rackroomshoes.com`
- Appears incomplete/broken

**Solution Implemented:**
1. ✅ Made affiliate links clickable (added <a href> tag with target="_blank")
2. ✅ Created redirect endpoint `/api/redirect.js` for tracking
3. ✅ Updated AgentApiDemo.js to display link in UI with click button

**Remaining Issue:**
- Fiber's affiliate_link URLs still don't work when clicked
- Need to investigate if URLs are malformed or missing tracking parameters
- Option: construct URLs from product data (merchant_url) if Fiber returns it

**Commits:**
- ab70f03: fix: make affiliate links clickable and add redirect tracking
- adb3584: add agent tracking to affiliate links and direct merchant fallback

**Root Cause Identified:**
- Fiber API returns: `https://wild.link/e?d=rackroomshoes.com&u=https%3A%2F%2Fwww.rackroomshoes.com`
- This URL returns HTTP 404 (endpoint doesn't exist on wild.link)
- Format appears to be Fiber-internal or incorrect

**Solution Deployed:**
- ✅ Added agent tracking parameter to Fiber's affiliate_link URLs
- ✅ Added direct merchant link fallback: `https://{merchant_domain}`
- Users can now click through to stores, but without affiliate tracking (pending Fiber fix)

**Status:** App is functional; awaiting Fiber to provide working affiliate URLs

---

## Next Steps
1. Contact Fiber about fixing affiliate_link format (currently returns 404)
2. Once Fiber provides working URLs, tracking will be automatic
3. Alternative: Contact Wildfire directly for proper affiliate link format

## Technical Notes
- Vercel prefers `npm install` over `npm ci` for monorepos/complex deps
- Platform-specific packages (fsevents) cause cross-environment issues
- Git submodules are problematic for serverless deployments (Vercel, Netlify)

